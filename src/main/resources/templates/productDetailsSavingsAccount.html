<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title th:text="#{product.add.title.product}">Title</title>
    <div th:replace="fragments/headerFooter::header-scripts"/>
    <div th:replace="fragments/headerFooter::chart-js-lib"/>

    <div th:replace="fragments/js:: percentCorrectionText"/>

    <script th:inline="javascript">
        /*<![CDATA[*/


        document.addEventListener("DOMContentLoaded", function () {
                console.log([[${json}]]);
                moment.locale('pl');
                var ctx = document.getElementById('valueChart').getContext('2d');
                ctx.canvas.width = 1000;
                ctx.canvas.height = 300;

                var valueData = JSON.parse([[${valueData}]]);
                var gainData = JSON.parse([[${gainData}]]);

                if (gainData[0].t > valueData[0].t) {
                    gainData.unshift(Object.assign({}, gainData[0]));
                    gainData[0].t = valueData[0].t;
                    gainData[0].y = 0;
                }

                console.log(valueData);
                console.log(gainData);

                var cfg = {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: [[#{product.charts.label.value}]],
                            yAxisID: 'A',
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgb(54, 162, 235)',
                            data: valueData,
                            type: 'line',
                            pointRadius: 3,
                            fill: false,
                            steppedLine: true,
                            borderWidth: 2
                        }, {
                            label: [[#{product.charts.label.gain}]],
                            yAxisID: 'B',
                            backgroundColor: 'rgba(41, 157, 41, 0.5)',
                            borderColor: 'rgb(41, 157, 41)',
                            data: gainData,
                            type: 'line',
                            steppedLine: true,
                            pointRadius: 3,
                            fill: false,
                            lineTension: 0,
                            borderWidth: 2
                        }
                        ]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                type: 'time',
                                distribution: 'linear',
                                ticks: {
                                    autoSkip: true,
                                    displayFormats: 'LL'
                                },
                                time: {
                                    tooltipFormat: 'LL',
                                    unit: 'month'
                                }
                            }],
                            yAxes: [{
                                id: 'A',
                                scaleLabel: {
                                    display: true,
                                    labelString: [[#{product.charts.label.value}]] + " (" + [[#{product.charts.label.currency}]] + ")"
                                },
                                ticks: {
                                    // min: 0
                                },
                            }, {
                                id: 'B',
                                position: 'right',
                                scaleLabel: {
                                    display: true,
                                    labelString: [[#{product.charts.label.gain}]] + " (" + [[#{product.charts.label.currency}]] + ")"
                                },
                                gridLines: {
                                    display: false
                                },
                                ticks: {
                                    min: 0
                                },
                            }]
                        },
                        tooltips: {
                            intersect: false,
                            mode: 'nearest',
                            callbacks: {
                                label: function (tooltipItem, myData) {
                                    var label = myData.datasets[tooltipItem.datasetIndex].data[tooltipItem.index].action || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += parseFloat(tooltipItem.value).toFixed(2);
                                    label += " " + [[#{product.charts.label.currency}]];
                                    return label;
                                }
                            }
                        }
                    }
                };

                var chart = new Chart(ctx, cfg);

            }
        )

        /*]]>*/
    </script>
</head>
<!--<div th:replace="fragments/headerFooter:: debugStyle"/>-->
<body>

<div th:replace="fragments/headerFooter:: navbar"/>

<div class="container">
    <div th:text="${json}"></div>
    <div class="row" style="margin-top: 1rem">
        <div class="col-sm-3"></div>
        <button class="btn btn-info" id="update">Update</button>
        <div class="col-sm-1"></div>
        <div class="col-sm-2">
            <form action="/product/all" class="form-inline" method="get">
                <input class="btn btn-primary" type="submit" value="Go back">
            </form>
        </div>
        <div class="col-sm-2">
            <form action="/product/operation/add" class="form-inline" method="get">
                <input type="submit" class="btn btn-info" value="Add new operation">
            </form>
        </div>
        <div class="col-sm-4"></div>
    </div>

    <div class="row">
        <div class="col-sm-8">
            <canvas id="valueChart"></canvas>
        </div>
        <div class="col-sm-4">
            <table class="table table-hover">
                <tr>
                    <th th:text="#{product.add.created}">created</th>
                    <td th:text="${product.created}"></td>
                </tr>
                <tr>
                    <th th:text="#{product.add.id}">id</th>
                    <td th:text="${product.id}"></td>
                </tr>
                <tr>
                    <th th:text="#{product.add.bank}">bank</th>
                    <td th:text="${product.bank}"></td>
                </tr>
                <tr>
                    <th th:text="#{product.add.value}">value</th>
                    <td th:text="${product.value}"></td>
                </tr>
                <tr>
                    <th th:text="#{product.add.openDate}">open_date</th>
                    <td th:text="${product.openDate}"></td>
                </tr>
                <tr>
                    <th th:text="#{product.add.validityDate}">validity_date</th>
                    <td th:text="${product.validityDate}"></td>
                </tr>
                <tr>
                    <th th:text="#{product.add.interest}">interest</th>
                    <td th:text="${product.interest}" class="percentage"></td>
                </tr>
                <tr>
                    <th th:text="#{product.add.valueLimit}">value_limit</th>
                    <td th:text="${product.valueLimit}"></td>
                </tr>
                <tr>
                    <th th:text="#{product.add.interestAboveLimit}">interest_above_limit</th>
                    <td th:text="${product.interestAboveLimit}" class="percentage"></td>
                </tr>
                <tr>
                    <th th:text="#{product.add.isActive}">is_active</th>
                    <td th:text="${product.isActive}"></td>
                </tr>
                <tr>
                    <th th:text="#{product.add.notes}">notes</th>
                    <td th:text="${product.notes}"></td>
                </tr>


            </table>
        </div>
    </div>

    <h6 class="text-center">Associated operations:</h6>

    <table class="table table-hover">
        <tr>
            <th th:text="#{action.add.id}">id</th>
            <th th:text="#{action.add.actionType}">actionType</th>
            <th th:text="#{action.add.actionDate}">actionDate</th>
            <th th:text="#{action.add.balanceChange}">balanceChange</th>
            <th th:text="#{action.add.afterActionValue}">afterActionValue</th>
            <th th:text="#{action.add.notes}">notes</th>
            <th th:text="#{action.add.isDone}">isDone</th>
            <th th:text="#{action.add.actions}">actions</th>
        </tr>
        <tr th:each="action: ${product.actions}">
            <td th:text="${action.id}"></td>
            <td th:text="${action.actionType}"></td>
            <td th:text="${action.actionDate}"></td>
            <td th:text="${action.balanceChange}"></td>
            <td th:text="${action.afterActionValue}"></td>
            <td th:text="${action.notes}"></td>
            <td th:text="${action.isDone}"></td>
            <td>
                <span th:if="${action.actionType==T(pl.zajacp.investmentmanager.actionmanagement.ActionType).BALANCE_CHANGE}">

                <form action="/product/operation/delete" method="post">
                    <input type="hidden" name="id" th:value="${action.id}">
                    <input type="submit" class="btn btn-danger" value="Delete">
                </form>
      </span>
            </td>
        </tr>

    </table>
    <div th:replace="fragments/headerFooter:: footer"/>
</div>

</body>
</html>



